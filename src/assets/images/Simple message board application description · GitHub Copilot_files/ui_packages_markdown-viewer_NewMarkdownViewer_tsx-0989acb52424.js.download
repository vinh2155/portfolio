"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_markdown-viewer_NewMarkdownViewer_tsx"],{26768:(e,t,s)=>{s.d(t,{A:()=>G});var i=s(74848),n=s(63867),l=s(27851),a=s(96540),r=s(45968),o=s(40961),d=s(96222);let m={"task-list-item":"TaskListItems-module__task-list-item--gViR6","numbered-task-list":"TaskListItems-module__numbered-task-list--WRIlb","numbered-task-list-nested":"TaskListItems-module__numbered-task-list-nested--eiXja","unordered-task-list":"TaskListItems-module__unordered-task-list--WS9ke","unordered-task-list-nested":"TaskListItems-module__unordered-task-list-nested--iS6sh","bullet-task-item":"TaskListItems-module__bullet-task-item--CGGup","numbered-task-item":"TaskListItems-module__numbered-task-item--Zjsc8","nested-overlay-list":"TaskListItems-module__nested-overlay-list--DWd6q","overlay-task-list-child":"TaskListItems-module__overlay-task-list-child--q26YD"};var c=s(65607),u=s(30422),k=s(64575);let h=e=>"string"==typeof e?.taskBox&&e?.text?.match(/[^\s\\]/)!==null,g=({container:e,nestedItems:t,globalIndex:s,markdownIndex:i,items:n,itemsData:l,nested:a=!1,lists:r,parentIsChecklist:o,hasDifferentListTypes:d})=>(n.map((n,m)=>{let c=Array.from(n.querySelectorAll(":scope > ul > li:not(.base-task-list-item), :scope > ol > li:not(.base-task-list-item)"))??[],u=Array.from(n.querySelectorAll(":scope > ul > li.task-list-item, :scope > ol > li.task-list-item"))??[],k=(Array.from(n.querySelectorAll("ul > li.task-list-item, ol > li.task-list-item, li.task-list-item"))??[]).length,h=[];k>0&&t.set(s.toString(),k);let p=n.classList.contains("task-list-item")?function(e,t){let s=t.parentElement?.closest(".contains-task-list");if(!s)throw Error("Could not find the item's parent list");let i=t?Array.from(s.children).indexOf(t):-1;return[e.indexOf(s),i]}(r,n):void 0,{title:f,content:x}=function(e){let t="",s="";for(let n of e.childNodes){var i;if("INPUT"===(i=n).nodeName||"UL"===i.nodeName||"OL"===i.nodeName||"#comment"===n.nodeName)continue;let e=n.textContent||"";if("#text"===n.nodeName){t+=e,s+=e;continue}if("CODE"===n.nodeName){t+=`\`${e}\``,s+=n.outerHTML;continue}t+=e,s+=n.outerHTML}return{title:t.trim(),content:s}}(n);l.push({id:s.toString(),index:m,title:f,content:x,checked:n.querySelector(".task-list-item-checkbox")?.checked===!0,position:p,container:n.parentElement,nested:a,children:h,markdownIndex:n.classList.contains("task-list-item")?i+=1:-1,isBullet:n.parentElement?.tagName==="UL"&&!n.classList.contains("task-list-item"),isNumbered:n.parentElement?.tagName==="OL"&&!n.classList.contains("task-list-item"),parentIsChecklist:o,hasNestedItems:k>0,hasDifferentListTypes:d});let I=c.length>0&&g({container:e,nestedItems:t,globalIndex:s+1,markdownIndex:i,items:c,itemsData:h,nested:!0,lists:r,parentIsChecklist:n.classList.contains("task-list-item"),hasDifferentListTypes:u.length>0&&c.length!==u.length});s=I?I.globalIndex:s+1,i=I?I.markdownIndex:i}),{globalIndex:s,markdownIndex:i}),p=async({markdownValue:e,markdownIndex:t,onChange:s})=>{let i=e.split(/\r?\n/),n=null,l=!1;for(let e=0,a=0;e<i.length;e++){let r=i[e];if(r.trim().startsWith("\x3c!--")&&(l=!0),l){r.trim().endsWith("--\x3e")&&(l=!1);continue}if(n){if(I(r,n)){n=null;continue}}else n=x(r);if(n)continue;let o=(0,k.VB)(r);if(h(o)){if(a===t){let t=(0,k.a1)(f(o));i.splice(e,1,t);let n=i.join(`
`);return await s(n)}a++}}},f=e=>({...e,taskBox:"[ ]"===e.taskBox?"[x]":"[ ]"}),x=e=>{let t=e.match(/^ {0,3}(`{3,}|~{3,})[^`]*$/);return t?t[1]:null},I=(e,t)=>RegExp(`^ {0,3}${t}${t[0]}* *$`).test(e),b={"task-list-item":"TaskListItem-module__task-list-item--hncv0",disabled:"TaskListItem-module__disabled--rVvkq","no-convert-task-list-item":"TaskListItem-module__no-convert-task-list-item--h_Byp","left-aligned-content":"TaskListItem-module__left-aligned-content--PRNTb","checkbox-items":"TaskListItem-module__checkbox-items--F0Yz2","drag-drop-container":"TaskListItem-module__drag-drop-container--ivNfi","drag-handle-icon":"TaskListItem-module__drag-handle-icon--WPdxE","show-trigger":"TaskListItem-module__show-trigger--pr6Zf","task-list-html":"TaskListItem-module__task-list-html--PQxW3",taskStatusCheckbox:"TaskListItem-module__taskStatusCheckbox--ANT4s",TaskListItemActionsContainer:"TaskListItem-module__TaskListItemActionsContainer--Dd_tK"};var v=s(10569),L=s(87330),T=s(15385),y=s(38621);let N={convertToIssue:"Convert to issue",convertToSubIssue:"Convert to sub-issue",moveUp:"Move up",moveDown:"Move down",openTaskOptions:e=>`Open ${e} task options`},_={TaskListMenuTriggerButton:"TaskListMenu-module__TaskListMenuTriggerButton--GR2W2"},w=({totalItems:e,onConvertToIssue:t,onConvertToSubIssue:s,item:n,allowIssueConversion:l,allowSubIssueConversion:r,disabled:o,setIsConverting:m,allowReordering:c,...u})=>{let{title:k,index:h,id:g}=n,{moveToPosition:p}=(0,d.gY)(),[f,x]=(0,a.useState)(!1),I=(0,a.useMemo)(()=>`task-list-menu-item-${g}`,[g]),b=e=>{if(e){let e=Array.from(document.querySelectorAll('[id^="task-list-menu-item-"]'));if(e.length>0){let t=e[Math.min(h,e.length-1)];t?.focus()}}else{let e=document.getElementById(I);e&&e.focus()}},w=({moveAction:e,e:t})=>{switch(t.preventDefault(),t.stopPropagation(),x(!1),e){case"up":p(h,h-1,!0);break;case"down":p(h,h+1,!1)}},j=({e,move:i,convertToIssue:l,convertToSubIssue:a})=>{e.preventDefault(),e.stopPropagation(),"Enter"===e.code&&i&&w({moveAction:i,e}),"Enter"===e.code&&l&&(x(!1),t?.(n,m,()=>{b(!1)})),"Enter"===e.code&&a&&(x(!1),s?.(n,m,()=>{b(!0)})),"Escape"===e.code&&x(!1)};return(0,i.jsxs)(v.W,{open:f,onOpenChange:x,children:[(0,i.jsx)(v.W.Anchor,{id:I,children:(0,i.jsx)(L.K,{"data-testid":u["data-testid"],icon:y.KebabHorizontalIcon,variant:"invisible","aria-label":N.openTaskOptions(k),disabled:o,className:_.TaskListMenuTriggerButton})}),(0,i.jsx)(v.W.Overlay,{children:(0,i.jsxs)(T.l,{children:[c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(T.l.Item,{onClick:e=>w({moveAction:"up",e}),onKeyDown:e=>j({e,move:"up"}),disabled:0===h,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(y.ChevronUpIcon,{})}),N.moveUp]}),(0,i.jsxs)(T.l.Item,{onClick:e=>w({moveAction:"down",e}),onKeyDown:e=>j({e,move:"down"}),disabled:h===e-1,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(y.ChevronDownIcon,{})}),N.moveDown]})]}),l&&t&&(0,i.jsxs)(T.l.Item,{onClick:()=>t?.(n,m),onKeyDown:e=>j({e,convertToIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert`,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(y.IssueOpenedIcon,{})}),N.convertToIssue]}),r&&s&&(0,i.jsxs)(T.l.Item,{onClick:()=>s?.(n,m),onKeyDown:e=>j({e,convertToSubIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert-sub-issue`,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(y.IssueTracksIcon,{})}),N.convertToSubIssue]})]})})]})};try{w.displayName||(w.displayName="TaskListMenu")}catch{}let j={ADD_TAGS:["math-renderer"],ADD_ATTR:["style","data-run-id","data-catalyst","class"]},C=/\/issues\/\d*\d/,S=(e,t)=>{let s=document.createElement("div");s.innerHTML=e;let i=s.querySelectorAll("span.reference");if(0===i.length)return!0;if(t||i.length>1)return!1;let n=i[0];return n.remove(),""===s.innerHTML.trim()&&!!C.test(n.innerHTML)};function $({markdownValue:e,onChange:t,onConvertToIssue:s,onConvertToSubIssue:l,nested:r=!1,position:o=1,item:m,totalItems:k,disabled:h,hideActions:g,itemIdToFocus:f,setitemIdToFocus:x,toggledItem:I,setToggledItem:v}){let[L,T]=(0,a.useState)(m.checked),[y,N]=(0,a.useState)(!1),[_,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(f&&!h){let e=document.getElementById(`task-list-menu-item-${f}`);e&&e.focus(),x?.(null)}},[f,h,x]),(0,a.useEffect)(()=>{I&&!h&&v(null)},[I,h,v]);let $=(0,a.useCallback)(e=>{T(!m.checked),v(m.id),p({markdownValue:e,markdownIndex:m.markdownIndex,onChange:t})},[m,t,v]),D=!r&&!m.hasDifferentListTypes||r&&o<2&&!m.parentIsChecklist&&!m.hasDifferentListTypes,[A,M]=(0,a.useMemo)(()=>[S(m.content,!0),S(m.content,!1)],[m.content]),B=`tasklist-item-${o}-${m.markdownIndex}`,O=!r||s&&l?b["task-list-item"]:b["no-convert-task-list-item"];return O+=` ${r&&k>0?"contains-task-list":""}`,O+=h?` ${b.disabled}`:"",(0,i.jsxs)("div",{className:O,onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),"data-testid":B,children:[(0,i.jsxs)("div",{className:b["left-aligned-content"],children:[(0,i.jsx)("div",{className:b["drag-drop-container"],children:D&&!h&&(0,i.jsx)(d.BS.DragTrigger,{className:`${b["drag-handle-icon"]} ${y?b["show-trigger"]:""}`,style:{width:"20px",height:"28px"}})}),(0,i.jsxs)("div",{className:b["checkbox-items"],id:`checkbox-item-${m.id}`,children:[(0,i.jsx)(c.A,{autoFocus:m.id===I,checked:L,disabled:h,onChange:t=>{t.preventDefault(),t.stopPropagation(),$(e)},"aria-label":`${m.title} checklist item`,className:b.taskStatusCheckbox}),(0,i.jsx)(u.JU,{html:m.content,className:b["task-list-html"],domPurifyConfig:j})]})]}),(0,i.jsxs)("div",{className:b.TaskListItemActionsContainer,children:[_&&(0,i.jsx)(n.A,{size:"small"}),!g&&D&&m.position&&!_&&(0,i.jsx)(w,{"data-testid":`${B}-menu`,onConvertToIssue:s,onConvertToSubIssue:l,totalItems:k,item:m,disabled:h,allowIssueConversion:A,allowSubIssueConversion:M,setIsConverting:C,allowReordering:D})]})]})}try{$.displayName||($.displayName="TaskListItem")}catch{}let D={ListItemContent:"ListItem-module__ListItemContent--v9OGu"};function A({item:e,position:t}){let s=`tasklist-item-${t}-${e.markdownIndex}`;return(0,i.jsx)(u.Pk,{html:e.content,as:"div","data-testid":s,className:D.ListItemContent})}try{A.displayName||(A.displayName="ListItem")}catch{}let M=(e,t)=>{let s,i=t.split(/\r?\n/),n=-1,l=-1,a=-1;for(let[t,r]of i.entries()){let i=(0,k.VB)(r),o=i?.leadingWhitespace.length;if(s&&(!r||void 0!==o&&o<=s.leadingWhitespace.length)){l=t>0?t-1:0;break}i&&h(i)&&++a===e&&(n=t,s=i)}return{startLineNumber:n,endLineNumber:l=-1===l?i.length-1:l}},B=({tasklists:e,markdownValue:t,externalOnChange:s,onConvertToIssue:n,onConvertToSubIssue:l,tasklistData:r,setTasklistData:c,disabled:u,viewerCanUpdate:k})=>{let[h,g]=(0,a.useState)(!1),[p,f]=(0,a.useState)(null),[x,I]=(0,a.useState)(null),b=(0,a.useCallback)(async({dragMetadata:e,dropMetadata:i,isBefore:n,items:l,container:a})=>{if(e.id===i?.id||u)return;g(!0);let o=l.find(t=>t.id===e.id)?.markdownIndex,d=l.find(e=>e.id===i.id)?.markdownIndex;if(void 0===o||void 0===d)return;let m=((e,t,s,i)=>{let{startLineNumber:n,endLineNumber:l}=M(s,e),{startLineNumber:a,endLineNumber:r}=M(i,e),o=e.split(/\r?\n/),d=l-n+1,m=[...o].splice(n,d);return t?(o.splice(n,d),o.splice(a,0,...m)):(o.splice(r+1,0,...m),o.splice(n,d)),o.join(`
`)})(t,n,o,d);c(((e,t,s,i,n,l)=>{let a=new Map(i),r=e.findIndex(e=>e.id===t),o=e[r];if(!o)return a;let d=[...e];d.splice(r,1);let m=d.findIndex(e=>e.id===s);d.splice(n?m:m+1,0,o);let c=i.get(l);if(!c)return a;if(c===e)a.set(l,d);else{let t=s=>{for(let i of s)i.children===e?i.children=d:i.children&&t(i.children)};t(c),a.set(l,c)}return a})(l,e.id,i.id,r,n,a)),s&&(await s(m),g(!1),f(i.id))},[u,t,r,c,s]),v=(0,a.useCallback)(async e=>{s&&(g(!0),await s(e),g(!1))},[s]);function L(e,s,r,o,c,g){let T=!e.isBullet&&!e.isNumbered,y="OL"===r.tagName?"ol":"UL"===r.tagName?"ul":"div";return(0,i.jsxs)(a.Fragment,{children:[T&&(0,i.jsx)($,{toggledItem:x,setToggledItem:I,markdownValue:t,onChange:v,onConvertToIssue:n,onConvertToSubIssue:l,nested:c,position:s,item:e,totalItems:o,disabled:u||h,hideActions:!k&&!h,setitemIdToFocus:f,itemIdToFocus:p}),!T&&(0,i.jsx)(A,{item:e,position:s}),e.children.length>0&&(0,i.jsx)(d.BS,{items:e.children,onDrop:t=>b({...t,items:e.children,container:r}),renderOverlay:(t,n)=>(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,className:m["task-list-item"],isDragOverlay:!0,style:{marginLeft:"-30px"},children:L(t,s+1,r,e.children.length,!0,!0)},t.id),as:"div",children:(0,i.jsx)(y,{className:"base-list-item",style:{listStyleType:"none",marginLeft:T?"12px":"-28px"},children:e.children.map((t,n)=>{let l=O({child:t,position:s}),a=E({child:t,isDragOverlay:g}),o=V({child:t,isDragOverlay:g});return(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,className:`${l} ${a} ${o}`,as:W(e)?"li":"div",children:L(t,s+1,r,e.children.length,!0,g)},t.id)})})})]},e.index)}return(0,a.useMemo)(()=>(0,i.jsx)(i.Fragment,{children:e.map((e,t)=>{let s=r.get(e)||[],n=s.filter(e=>!e.isBullet&&!e.isNumbered),l="OL"===e.tagName?"ol":"UL"!==e.tagName||e.classList.contains("contains-task-list")&&n.length===s.length?"div":"ul";return s.length>0?(0,o.createPortal)((0,i.jsx)("li",{className:"base-task-list-item",style:{listStyle:"none",marginLeft:"-28px"},children:(0,i.jsx)(d.BS,{items:s,onDrop:t=>b({...t,items:s,container:e}),style:{marginTop:"1px"},renderOverlay:(t,n)=>(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,isDragOverlay:!0,children:L(t,0,e,s.length,!1,!0)},t.id),as:"div",children:(0,i.jsx)(l,{className:"base-list-item",style:{marginLeft:n.length!==s.length&&n.length?"5px":"0px"},children:s.map((t,n)=>(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,className:t.isBullet?m["bullet-task-item"]:t.isNumbered?m["numbered-task-item"]:m["task-list-item"],as:W(t)?"li":"div",style:{marginLeft:t.isBullet||t.isNumbered||!t.hasDifferentListTypes?"0px":"-28px",marginRight:"-8px"},children:L(t,0,e,s.length,!1,!1)},t.id))})})}),e,t.toString()):null})}),[t,r,u])},O=({child:e,position:t})=>e.isNumbered?t+1<2?m["numbered-task-list"]:m["numbered-task-list-nested"]:e.isBullet?t+1<2?m["unordered-task-list"]:m["unordered-task-list-nested"]:m["task-list-item"],E=({child:e,isDragOverlay:t})=>!e.isBullet&&!e.isNumbered&&(t?m["nested-overlay-list"]:e.parentIsChecklist||e.hasDifferentListTypes?"":m["task-list-item"]),V=({child:e,isDragOverlay:t})=>(e.isBullet||e.isNumbered)&&(t?m["overlay-task-list-child"]:""),W=e=>(e.isNumbered||e.isBullet)&&!e.hasDifferentListTypes||e.hasDifferentListTypes||e.children.length>0;try{B.displayName||(B.displayName="TaskListItems")}catch{}let q={spinner:"NewMarkdownViewer-module__spinner--2QW6e","safe-html-box":"NewMarkdownViewer-module__safe-html-box--cRsz0"};var P=s(34164),R=s(17515);let U=[],K=function(e,t,s){let[i,n]=(0,a.useState)([]);return(0,R.N)(()=>{let s=Array.from(e.current?.querySelectorAll(t)??U);n(e=>!function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}(e,s)?s:e)},[s,e,t]),i};var F=s(46847);let H=/\b(href|src)\s*=\s*(['"])([^'"?]{1,2000})(\?(?:[^'"]{0,1000}?))token=([^&#"']{0,500})([^'"]{0,1000})\2/gi,G=({verifiedHTML:e,markdownValue:t="",onChange:s,onConvertToIssue:o,onConvertToSubIssue:d,onLinkClick:m,openLinksInNewTab:c=!1,loading:u=!1,disabled:k,viewerCanUpdate:h,className:p})=>{let f=(0,a.useRef)(null),x=K(f,".contains-task-list:not(.contains-task-list .contains-task-list)",e),I=(0,a.useRef)(""),b=(0,l.G7)("issues_preserve_tokens_in_urls"),v=(0,a.useMemo)(()=>b?function(e,t){H.lastIndex=0;let s=0;return e.replace(H,(e,i,n,l,a,r,o)=>{if(++s>1e3)return e;let d=`${l}${a}token=TOKEN_PLACEHOLDER${o}`;return t.hasOwnProperty(d)?`${i}=${n}${l}${a}token=${t[d]}${o}${n}`:e})}(e,function(e){let t,s={};H.lastIndex=0;let i=0;for(;null!==(t=H.exec(e))&&!(++i>1e3);){let e=t[3],i=t[4],n=t[5],l=t[6];e&&n&&(s[`${e}${i}token=TOKEN_PLACEHOLDER${l}`]=n)}return s}(I.current)):e,[e,b]);I.current=v;let{tasklistData:L,nestedItems:T,setTasklistData:y}=((e,t)=>{let[s,i]=(0,a.useState)(()=>new Map),[n,l]=(0,a.useState)(()=>new Map);return(0,R.N)(()=>{if(!e)return;let s=function({container:e,tasklists:t}){let s=new Map,i=new Map,n=function(e,t="ul:not(.base-list-item), ol:not(.base-list-item)"){return Array.from(e.querySelectorAll(t)).filter(e=>!e.closest("tracking-block"))}(e),l=0,a=-1;for(let r of t){let t=Array.from(r.querySelectorAll(":scope > li:not(.base-task-list-item)")),o=r.querySelectorAll(":scope > li.task-list-item"),d=[],{globalIndex:m,markdownIndex:c}=g({container:e,nestedItems:i,globalIndex:l,markdownIndex:a,items:t,itemsData:d,nested:!1,lists:n,parentIsChecklist:r.classList.contains("task-list-item"),hasDifferentListTypes:o.length>0&&o.length!==t.length});for(let e of(l=m,a=c,s.set(r,d),t))e.remove()}return{newData:s,nestedItems:i}}({container:e,tasklists:t});i(s.newData),l(s.nestedItems)},[e,t]),{tasklistData:s,nestedItems:n,setTasklistData:i,setNestedItems:l}})(f.current,x);(0,F.O)({htmlContainerRef:f,onLinkClick:m,openLinksInNewTab:c});let N=(0,a.useMemo)(()=>{let e=["markdown-body",q["safe-html-box"]];return p&&e.push(p),(0,i.jsx)(r.vb,{ref:f,className:(0,P.$)(e),html:v})},[p,v]);return u?(0,i.jsx)("div",{className:(0,P.$)(q.spinner),children:(0,i.jsx)(n.A,{"aria-label":"Loading markdown content..."})}):(0,i.jsxs)(i.Fragment,{children:[N,x.length>0&&(0,i.jsx)(B,{tasklists:x,markdownValue:t,externalOnChange:s,onConvertToIssue:o,onConvertToSubIssue:d,tasklistData:L,setTasklistData:y,nestedItems:T,disabled:k||!s,viewerCanUpdate:h})]})};try{G.displayName||(G.displayName="NewMarkdownViewer")}catch{}}}]);
//# sourceMappingURL=ui_packages_markdown-viewer_NewMarkdownViewer_tsx-8ebf43991a02.js.map